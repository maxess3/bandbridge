generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

enum Provider {
  MANUAL
  GOOGLE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum UserRole {
  USER
  ADMIN
}

enum ProfileRole {
  MUSICIAN
  PROFESSIONAL
  TALENT_SCOUT
}

enum MusicGenre {
  ROCK
  JAZZ
  ELECTRO
  POP
  FOLK
  BLUES
  HIP_HOP
  RAP
  R_AND_B
  METAL
  PUNK
  COUNTRY
  REGGAE
  FUNK
  SOUL
  ALTERNATIVE
  INDIE
  ACOUSTIC
  LATINO
  CLASSICAL
  CELTIC
  SKA
  LOUNGE
  RELIGIOUS
  OTHER
}

enum Platform {
  YOUTUBE
  INSTAGRAM
  TIKTOK
  TWITTER
  SOUNDCLOUD
}

enum ConcertCount {
  NOT_SPECIFIED
  LESS_THAN_10
  TEN_TO_FIFTY
  FIFTY_TO_HUNDRED
  MORE_THAN_HUNDRED
}

enum RehearsalFrequency {
  NOT_SPECIFIED
  ONCE_PER_WEEK
  TWO_TO_THREE_PER_WEEK
  MORE_THAN_THREE_PER_WEEK
}

enum PracticeType {
  NOT_SPECIFIED
  HOBBY
  ACTIVE
}

enum InstrumentLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum InstrumentCategory {
  STRINGS
  WIND
  PERCUSSION
  KEYBOARD
  ELECTRONIC
  OTHER
}

model User {
  id                  String    @id @default(uuid())
  email               String    @unique
  provider            Provider  @default(MANUAL)
  password            String?
  created_at          DateTime  @default(now())
  role                UserRole  @default(USER)
  verified            Boolean   @default(false)
  password_changed_at DateTime?
  firstName           String    @db.VarChar(60)
  lastName            String    @db.VarChar(60)
  username            String?   @unique
  gender              Gender    @default(OTHER)
  birthDate           DateTime? @db.Date
  Profile             Profile?  @relation
  Post                Post[]
}

model Profile {
  id                String             @id @default(uuid())
  pseudonyme        String             @db.VarChar(60)
  followers         Profile[]          @relation("UserFollows")
  following         Profile[]          @relation("UserFollows")
  role              ProfileRole        @default(MUSICIAN)
  instruments       Instrument[]
  genres            MusicGenre[]
  socialLinks       SocialLink[]
  band              Band[]
  lastActiveAt      DateTime?
  profilePictureKey String?
  description       String?            @db.Text
  concertsPlayed    ConcertCount       @default(NOT_SPECIFIED)
  rehearsalsPerWeek RehearsalFrequency @default(NOT_SPECIFIED)
  practiceType      PracticeType       @default(NOT_SPECIFIED)
  isLookingForBand  Boolean            @default(false)
  country           String?            @db.VarChar(60)
  city              String?            @db.VarChar(60)
  zipCode           String?            @db.VarChar(10)
  departmentName    String?            @db.VarChar(60)
  userId            String             @unique
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  hiringAds         HiringAd[]
}

model InstrumentType {
  id          String             @id @default(uuid())
  name        String             @unique
  category    InstrumentCategory
  profession  String? // Profession liée à l'instrument (ex: "Guitarist" pour "Guitar")
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  instruments Instrument[]
}

model Instrument {
  id               String           @id @default(uuid())
  level            InstrumentLevel?
  order            Int              @default(0) // Ordre d'utilisation (0 = principal, 1 = secondaire, etc.)
  profileId        String
  instrumentTypeId String
  profile          Profile          @relation(fields: [profileId], references: [id], onDelete: Cascade)
  instrumentType   InstrumentType   @relation(fields: [instrumentTypeId], references: [id], onDelete: Cascade)

  @@unique([profileId, instrumentTypeId])
}

model SocialLink {
  id        String   @id @default(uuid())
  platform  Platform
  url       String
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([platform, profileId])
}

model Band {
  id             String         @id @default(uuid())
  name           String         @unique
  genres         MusicGenre[]
  description    String?        @db.Text
  country        String?        @db.VarChar(60)
  city           String?        @db.VarChar(60)
  zipCode        String?        @db.VarChar(10)
  departmentName String?        @db.VarChar(60)
  members        Profile[]
  hiringAds      BandHiringAd[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model BandHiringAd {
  id        String   @id @default(uuid())
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  bandId    String
  band      Band     @relation(fields: [bandId], references: [id], onDelete: Cascade)

  @@unique([bandId, title])
}

model HiringAd {
  id        String   @id @default(uuid())
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, title])
}

model Post {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  department String   @db.VarChar(60)
  city       String   @db.VarChar(60)
  title      String
  content    String
  country    String   @db.VarChar(60)
  user_id    String
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, title])
}
